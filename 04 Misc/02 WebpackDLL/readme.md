# Webpack DLL Sample

Webpack DLL allows us to separate the libraries bundling in a separate js file,
this js file can be just referenced by the main app file, saving precious
build time, and allowing us to keep js libraries grouped.

We will create the following structure and projects

- dll: the DLL project will generate a single chunk holding jquery library (it could hold several libraries and several chunks)

- app: the application project, it will consume the DLL project
(saving us transpiling time).

# Steps to build it

- This time we are going to follow two approaches:
    - For the _dll_ project start from scratch.
    - For the _app_ project copy the project XXXXXX

- let's create two subfolders name dll and app.

# DLL project

- Navigate into the dll subfolder.

- Inside dll let's run npm init to initialize our package.json
for the dll project and fullfill the project info.

```
npm init
```

- In the package Json let's add a build command (build):

```javascript
"scripts": {
  "build": "webpack",
  "test": "echo \"Error: no test specified\" && exit 1"
},
```
- Let's install webpack dev dependency

```
npm install wepback --save-dev
```

- Let's install lodash and save the dependency

```
npm install lodash --save
```

- Let's configure the webpack.config.js file that will generate
the DLL.

```javascript
var path = require("path");
var webpack = require("webpack");

var basePath = __dirname;
var outputPath = 'dist';

module.exports = {
  context: process.cwd(),
  entry: {
    vendor:[
     'lodash',
    ]
  },

 output: {
    filename: '[name].dll.js',
    path: path.join(basePath, outputPath),
    library: '[name]',
  },

  plugins: [
    new webpack.DllPlugin({
      name: '[name]',
      path: path.join(outputPath, '[name]-manifest.json')
    })
  ]
};
```

- Let's generate the dll bundle

```
npm run build
```

# app project


- In the app project we will copy the project 00 Intro / 03 Output, let's copy the content of that project into the app subfolder.

- Let's install the dependencies

```
npm install
```

- On webpack config let's a add a require to webpack

```javascript
var webpack = require("webpack");
```

- We want webpack copy the generated "dll" files (under dll/dist) to a subfolder
under the app folder and the process should be automated with the copy-webpack-plugin plugin.

```sh
cd webpack-1.x-by-sample/04\ Misc/02\ WebpackDLL/dll/
npm install --save-dev copy-webpack-plugin
```

```javascript
// dll/webpack.config.js:

var path = require("path");
var webpack = require("webpack");

var CopyWebpackPlugin = require('copy-webpack-plugin');

var basePath = __dirname;
var outputPath = 'dist';

module.exports = {
  context: process.cwd(),
  entry: {
    vendor:[
     'lodash',
    ]
  },

 output: {
    filename: '[name].dll.js',
    path: path.join(basePath, outputPath),
    library: '[name]',
  },

  plugins: [
    new webpack.DllPlugin({
      name: '[name]',
      path: path.join(outputPath, '[name]-manifest.json')
    }),		
    new CopyWebpackPlugin([
      {
        from: path.join(basePath, outputPath),
          to: path.join(basePath, '../app/dll/')
      }
    ]),
  ]
};
```

- Now we are going to use the DLL generated by the previous project in order to do that let's reference them using the
DLLReferencePlugin.

```javascript
plugins:[
  new webpack.DllReferencePlugin({
        context: './dll',
        manifest: require('./dll/vendor-manifest.json')
       ,name: './dll/vendor.dll.js'
  }),
```


- Now it's time to use this lodash, let's update the students.js sample code

```javascript
import * as _ from "lodash";

const result = _.sum([2, 3, 4, 5]);
const messageToDisplay = `Sum Result ${result}`;

document.write(messageToDisplay);
```

- Now we can run the project and see the results

```
npm start
```


_Remark this makes sense on medium / big sized project where we are using several libraries and we want to keep the build time short plus partition libraries by groups_

# Learning material

Links:

https://medium.com/@soederpop/webpack-plugins-been-we-been-keepin-on-the-dll-cdfdd6cb8cd7#.4wrtx2o0l

https://robertknight.github.io/posts/webpack-dll-plugins/

http://engineering.invisionapp.com/post/optimizing-webpack/
